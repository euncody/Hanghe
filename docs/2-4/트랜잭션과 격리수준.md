
# 🔄 트랜잭션과 격리 수준 쉽게 이해하기

## 트랜잭션(Transaction)이란?

> **트랜잭션 = 하나의 작업 단위**  
> 여러 작업을 묶어서 **전부 성공하거나, 전부 실패하게 처리하는 것**.

### 🍱 비유: 도시락 만들기

1. 밥 담기
2. 반찬 담기
3. 뚜껑 닫기

👉 도시락 만들기 **세 단계 중 하나라도 실패하면 전체 취소**하고 다시 시작해야 해.  
예) 밥을 엎었으면 도시락 전체 다시 만들어야지.

---

## ✅ 트랜잭션의 4대 특징 (ACID)

| 특징     | 설명 |
|----------|------|
| **원자성 (Atomicity)** | 전부 성공하거나 전부 실패 |
| **일관성 (Consistency)** | 데이터의 규칙이 항상 지켜짐 |
| **격리성 (Isolation)** | 다른 작업과 **섞이지 않음** |
| **지속성 (Durability)** | 성공한 결과는 **영구 반영**됨 |

---

## 🧩 격리 수준(Isolation Level)이란?

> **여러 트랜잭션이 동시에 실행될 때, 서로 얼마나 간섭하지 않도록 할까?**  
=> **얼마나 "고립"시킬지 결정하는 설정**

---

## 격리 수준 종류 (낮은 수준 → 높은 수준)

| 수준 | 설명 | 문제점 |
|------|------|--------|
| **READ UNCOMMITTED** | **커밋 안 된 값도 읽음** | **더러운 읽기(Dirty Read)** 가능 |
| **READ COMMITTED** | **커밋된 값만 읽음** | 반복 읽기 불가 (Non-Repeatable Read) |
| **REPEATABLE READ** | **같은 값은 항상 동일하게 읽음** | **팬텀 리드(Phantom Read)** 가능 |
| **SERIALIZABLE** | 완벽 고립, **순차 처리처럼 동작** | 느림, 성능 저하 가능 |

---

## 💣 격리 수준 문제 예시

| 문제           | 설명 |
|----------------|------|
| **Dirty Read** | 다른 트랜잭션이 **아직 커밋 안 한 값**을 읽음 |
| **Non-Repeatable Read** | 같은 쿼리를 두 번 했는데 결과가 다름 |
| **Phantom Read** | 조건에 맞는 행이 **중간에 추가/삭제됨** |

---

## 💡 정리

1. 트랜잭션은 여러 작업을 **묶어서 전부 성공/실패로 처리**하는 장치다.
2. 격리 수준은 **여러 트랜잭션이 서로 영향을 얼마나 받지 않도록 할지** 정하는 설정이다.
3. 격리 수준이 높을수록 안전하지만 성능이 느려질 수 있다.

---

# 🤔 고립시킨다는 건 무슨 의미일까?

## 🚪 고립(격리)의 진짜 의미

> 여러 명(트랜잭션)이 **같은 데이터**에 접근할 때,  
어떤 사람은 **읽고**, 어떤 사람은 **수정**하고 있을 수 있음.

👉 고립시킨다는 건 **내 작업 도중 다른 작업이 방해하지 못하게 막는 것**.

---

## 🔐 고립 방법: DB가 처리하는 방식

### 1. 락(Lock) 사용하기

- 트랜잭션이 데이터를 **읽거나 수정할 때 락을 걸어서**  
다른 트랜잭션이 그 데이터에 **접근하지 못하게 막음**.

👉 "잠깐! 나 먼저 할게!" 하고 막는 것.

### 2. 스냅샷(Snapshot) 방식

- 다른 트랜잭션이 데이터 수정 중이라도  
나는 **그 시점의 복사본(스냅샷)**을 보고 작업함.

👉 사진 찍어두고 그걸로 작업하는 것과 비슷.

---

## ⚖️ 격리 수준마다 고립 방식 차이

| 격리 수준        | 고립 방식         | 간섭 가능성 |
|------------------|------------------|-------------|
| READ UNCOMMITTED | 락 거의 없음     | 간섭 큼 😱 |
| READ COMMITTED   | 수정 중엔 못 읽음 | 중간 정도 🙂 |
| REPEATABLE READ  | 읽기 락 사용     | 간섭 적음 👍 |
| SERIALIZABLE     | 모든 작업 순서대로 | 완전 고립 😇 |

---

## 💬 정리

1. 고립시킨다는 건 **다른 작업이 내 작업을 방해하지 못하게 차단**하는 것.
2. DB는 이를 위해 **락을 걸거나 복사본을 보여주는 방식**을 사용.
3. 격리 수준을 우리가 정하면, **DB가 자동으로 알아서 처리해줌**.

---

# 🖥️ 이걸 DB가 한다는 거지?

맞아! **트랜잭션의 고립(격리)은 전부 DB가 자동으로 처리해줌.**

## DB가 해주는 일 (자동 처리 3단계)

| DB가 해주는 일 | 설명 |
|----------------|------|
| **1. 락 걸기** | 읽거나 수정할 때 **다른 트랜잭션 대기** |
| **2. 순서 조정** | 충돌 안 나게 **실행 순서 맞춤** |
| **3. 복사본 제공** | **스냅샷**으로 안정적으로 작업함 |

---

## DB 종류마다 방식이 다름

| DB 종류      | 격리 방식 예시 |
|--------------|----------------|
| **MySQL (InnoDB)** | 락 + 스냅샷 혼합 (MVCC) |
| **PostgreSQL**     | 주로 스냅샷 방식 (MVCC) |
| **Oracle**         | 고급 락과 트랜잭션 관리 |

👉 우리는 **격리 수준만 설정하면**, 나머지는 DB가 알아서 해줌!

---

## 💡 정리

1. 트랜잭션의 격리/고립은 **DB가 락 걸고 순서 조정하며 처리함**.
2. 우리는 격리 수준만 정하면 DB가 충돌 없이 안전하게 동작시킴.
3. 덕분에 **데이터가 꼬이지 않고 신뢰성 있게 처리됨**.
