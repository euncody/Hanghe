
# 단일 서버 vs 분산 서버와 Redis 분산락

## 1. 단일 서버 (Single Server)
- 애플리케이션이 **한 대의 서버**에서만 동작
- 모든 요청과 데이터 처리가 **하나의 프로세스/메모리 공간**에서 이루어짐
- 로컬 메모리를 공유하므로 `synchronized`, `ReentrantLock` 같은 **로컬 락**으로 동시성 제어 가능

**구조 예시**
```
[사용자들] → [서버 A] → [DB]
```

**특징**
- 구현이 간단함
- 한 대 서버 성능 한계에 종속됨
- 서버 장애 시 서비스 전체 중단

---

## 2. 분산 서버 (Distributed Server)
- 애플리케이션이 **여러 대의 서버**에서 동시에 동작
- 보통 로드 밸런서를 통해 요청이 분산됨
- 서버 간 **메모리를 공유하지 않음**
- 따라서 로컬 락(`synchronized`)은 서버 간 동시성 제어에 효과 없음

**구조 예시**
```
[사용자들] → [로드밸런서]
    ├─ [서버 A] → [DB]
    └─ [서버 B] → [DB]
```

**분산 서버를 사용하는 이유**
1. **트래픽 처리량 증가**
2. **서비스 안정성(고가용성)**
3. **무중단 배포**
4. **지리적 분산**
5. **확장성**

---

## 3. 공유 자원과 락
- 분산 서버 환경에서 **DB, 파일, 캐시** 같은 공유 자원을 동시에 접근할 수 있음
- 동시에 수정하면 데이터 불일치나 충돌 발생
- 해결책: **락(Lock)**으로 한 번에 한 서버만 자원 수정 가능하게 함

### 락 종류
1. **낙관적 락 (Optimistic Lock)**  
   - 충돌이 드물다고 가정, 버전 비교로 충돌 감지
2. **비관적 락 (Pessimistic Lock)**  
   - 충돌이 날 거라고 가정, 트랜잭션 동안 자원 잠금
3. **분산 락 (Distributed Lock)**  
   - 여러 서버가 **공유 자원**을 사용할 때 중앙 저장소를 통해 락 상태를 관리

---

## 4. Redis와 분산 락
- Redis는 네트워크로 접근 가능한 **인메모리 저장소**
- 여러 서버가 동시에 접근 가능 → **중앙에서 락 상태를 저장하고 관리**
- 빠른 읽기/쓰기 성능으로 분산락 구현에 적합
- Redisson 같은 라이브러리를 사용하면 락 획득/해제, TTL 관리, 장애 복구까지 쉽게 구현 가능

**Redis 분산락 동작 원리 (단일 노드 예시)**
1. **락 획득**: `SET key value NX PX ttl`
2. **작업 수행**: 락 잡은 서버만 자원 수정
3. **락 해제**: 키 삭제 또는 TTL 만료

---

## 5. 전체 흐름
1. **단일 서버**에서는 로컬 락으로 충분
2. **분산 서버**에서는 서버 간 메모리가 공유되지 않아 로컬 락 무의미
3. **공유 자원(DB 등)** 접근 시 충돌 방지를 위해 **분산락 필요**
4. **Redis**를 중앙 저장소로 사용해 분산락 구현
5. **Redisson**으로 Redis 분산락을 쉽게 적용 가능

---

**한 줄 요약**
> 분산 서버 환경에서 여러 서버가 같은 자원을 동시에 건드리면 충돌이 발생할 수 있다.  
> 이를 방지하기 위해 Redis를 중앙 저장소로 사용하여 분산락을 구현하며, Redisson이 이를 쉽게 도와준다.
