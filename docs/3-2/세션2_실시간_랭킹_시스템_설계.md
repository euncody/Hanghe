# 세션 2: 실시간 랭킹 시스템 설계

## 🎯 핵심 메시지

* **Sorted Set**은 점수 기반으로 실시간 랭킹을 구현하기에 최적화된 자료구조이다.
* **TTL**을 함께 사용하면 **일간/주간 랭킹** 같은 시간 단위 랭킹 관리가 가능하다.

---

## ⚡ 빠르게 배우는 포인트

### 1. 필수 명령어 흐름

| 명령어        | 설명                   | 예시                                           |
| ---------- | -------------------- | -------------------------------------------- |
| `ZADD`     | 점수와 함께 사용자 추가/갱신     | `ZADD ranking:daily:2025-08-21 100 user1`    |
| `ZINCRBY`  | 특정 사용자의 점수 증가        | `ZINCRBY ranking:daily:2025-08-21 10 user2`  |
| `ZREVRANK` | 사용자 순위 조회 (높은 점수 1등) | `ZREVRANK ranking:daily:2025-08-21 user1`    |
| `EXPIRE`   | 랭킹 키에 TTL 설정         | `EXPIRE ranking:daily:2025-08-21 86400` (1일) |

---

### 2. 키 전략

* **일간 랭킹**: `ranking:daily:{date}`

    * 예: `ranking:daily:2025-08-21`
* **주간 랭킹**: `ranking:weekly:{year-week}`

    * 예: `ranking:weekly:2025-W34`

---

### 3. 동률 점수 보완 전략

* 점수가 같으면 순위가 애매해지므로, **타임스탬프를 점수에 가중치로 병합**하는 방법 사용.
* 예:

    * 점수 = `(실제 점수 * 1000000) + (타임스탬프)`
    * 더 최근에 기록한 사용자가 높은 순위를 유지.

---

## ❓ 퀴즈 (Check Point)

1. **ZREVRANGE와 ZREVRANK의 차이는?**

    * `ZREVRANGE`: 특정 범위의 사용자와 점수 목록 조회.
    * `ZREVRANK`: 특정 사용자의 순위만 조회.

2. **일간 랭킹에 TTL을 적용하지 않았을 때 생기는 문제는?**

    * 이전 날짜의 랭킹 데이터가 계속 쌓여 **메모리 낭비** 발생.
    * “오늘의 랭킹”을 조회할 때 **이전 데이터가 섞이는 오류** 가능.

